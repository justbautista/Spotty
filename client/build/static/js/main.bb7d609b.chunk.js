(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{49:function(e,t,s){},50:function(e,t,s){"use strict";s.r(t);var c=s(1),n=s.n(c),a=s(21),i=s.n(a),r=s(6),o=s.n(r),l=s(7),d=s(3),j=(s(28),s(29),"https://accounts.spotify.com/authorize?client_id=".concat("b61700da73754441825c847b8ea113b1","&response_type=code&redirect_uri=").concat("http://localhost:3000","&scope=").concat(["streaming","user-top-read","user-read-email","user-read-private","user-library-read","user-library-modify","user-read-playback-state","user-modify-playback-state"].join("%20"),"&show_dialog=true")),m=s(22),u=s.n(m).a.create({baseURL:"https://git.heroku.com/song-bird-app-server.git"}),h=function(e){x(),localStorage.setItem("spotify_access_token",e)},b=function(){return localStorage.getItem("spotify_access_token")},x=function(){var e=new Date(Date.now()+36e5).getTime();localStorage.setItem("spotify_expiration_time",e)},f=function(){return localStorage.getItem("spotify_expiration_time")},p=s(0);function g(){return Object(p.jsx)("div",{className:"container",style:{height:"100vh",backgroundColor:"white"}})}var O=s.p+"static/media/Spotify_Icon_RGB_White.ecd54051.png",v=s.p+"static/media/bird-white.5b765ff2.png";function y(){var e=Object(c.useState)(!0),t=Object(d.a)(e,2),s=t[0],n=t[1];return Object(c.useEffect)((function(){n(!0);var e=new URLSearchParams(window.location.search).get("code"),t=new URLSearchParams(window.location.search).get("error");if(t)return n(!1),window.history.pushState({},null,"/"),void console.log(t);e?u.post("/auth/login",{code:e}).then((function(e){var t;h(e.data.accessToken),t=e.data.refreshToken,localStorage.setItem("spotify_refresh_token",t),window.history.pushState({},null,"/dashboard"),window.location.reload()})).catch((function(e){n(!1)})):n(!1)}),[]),s?Object(p.jsx)(g,{}):Object(p.jsxs)("div",{className:"container-fluid d-flex flex-column justify-content-center align-items-center",style:{height:"100vh",color:"white"},children:[Object(p.jsxs)("div",{className:"text-center",children:[Object(p.jsx)("img",{src:v,style:{height:"50px"}}),Object(p.jsx)("h1",{children:"songbird"})]}),Object(p.jsxs)("a",{className:"btn btn-lg mt-5",style:{backgroundColor:"#1DB954",color:"white",borderRadius:"40px"},href:j,children:["Login",Object(p.jsx)("img",{className:"ms-2",style:{height:"30px"},src:O})]})]})}function k(e){var t=e.track,s=e.index,c=function(e){var t=Math.floor(e/6e4),s=(e%6e4/1e3).toFixed(0);return t+":"+(s<10?"0":"")+s}(t.duration_ms);return Object(p.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[Object(p.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-around me-3",children:[Object(p.jsx)("small",{children:s+1}),Object(p.jsx)("img",{className:"mx-3",src:t.album.images[t.album.images.length-1].url,height:"50px"}),Object(p.jsxs)("div",{className:"d-flex flex-column",children:[Object(p.jsx)("h6",{children:t.name}),Object(p.jsx)("small",{children:t.artists.map((function(e,s){return e.name+(s==t.artists.length-1?"":", ")}))})]})]}),Object(p.jsxs)("div",{className:"d-flex flex-row align-items-center text-end",children:[Object(p.jsx)("small",{children:t.album.name}),Object(p.jsx)("small",{className:"ms-3",children:c})]})]})}function w(e){var t=e.artist,s=e.index;return Object(p.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[Object(p.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-around",children:[Object(p.jsx)("small",{children:s+1}),Object(p.jsx)("img",{className:"mx-3",src:t.images[t.images.length-1].url,height:"50px"}),Object(p.jsxs)("div",{className:"d-flex flex-column",children:[Object(p.jsx)("h5",{children:t.name}),Object(p.jsx)("small",{style:{textTransform:"capitalize"},children:t.genres.map((function(e,s){return e+(s==t.genres.length-1?"":", ")}))})]})]}),Object(p.jsx)("div",{children:Object(p.jsx)("div",{className:"progress ms-3",style:{width:"100px"},children:Object(p.jsx)("div",{className:"progress-bar",style:{width:"".concat(t.popularity,"%"),backgroundColor:"#1DB954"}})})})]})}function N(){var e=Object(c.useState)("tracks"),t=Object(d.a)(e,2),s=t[0],n=t[1],a=Object(c.useState)("short_term"),i=Object(d.a)(a,2),r=i[0],o=i[1],l=Object(c.useState)([]),j=Object(d.a)(l,2),m=j[0],h=j[1],x=Object(c.useState)([]),f=Object(d.a)(x,2),g=f[0],O=f[1],v=b();function y(e){var t=document.getElementById("tracks"),s=document.getElementById("artists");"tracks"==e&&t.classList.contains("active")||"artists"==e&&s.classList.contains("active")||(t.classList.toggle("active"),s.classList.toggle("active"),n(e))}function N(e){var t=document.getElementById("this-month"),s=document.getElementById("last-6-months"),c="";e!=(c=t.classList.contains("active")?"this-month":s.classList.contains("active")?"last-6-months":"all-time")&&(document.getElementById(e).classList.toggle("active"),document.getElementById(c).classList.toggle("active"),o("this-month"==e?"short_term":"last-6-months"==e?"medium_term":"long_term"))}return Object(c.useEffect)((function(){"tracks"==s&&u.post("/spotify/topTracks",{timeRange:r,accessToken:v}).then((function(e){h(e.data.topTracks)})).catch((function(e){}))}),[s,r]),Object(c.useEffect)((function(){"artists"==s&&u.post("/spotify/topArtists",{timeRange:r,accessToken:v}).then((function(e){O(e.data.topArtists)})).catch((function(e){}))}),[s,r]),Object(p.jsxs)("div",{className:"container-fluid",id:"top-items-container",children:[Object(p.jsx)("div",{className:"container-fluid text-center my-5",children:Object(p.jsxs)("h1",{style:{textTransform:"capitalize",margin:"0",color:"white"},children:["Top ",s]})}),Object(p.jsxs)("div",{className:"d-flex flex-row justify-content-between my-3",style:{fontSize:"12px"},children:[Object(p.jsxs)("ul",{className:"nav nav-pills",children:[Object(p.jsx)("li",{style:{cursor:"pointer"},className:"nav-item",children:Object(p.jsx)("a",{className:"nav-link active",id:"tracks",onClick:function(){y("tracks")},children:"Tracks"})}),Object(p.jsx)("li",{style:{cursor:"pointer"},className:"nav-item",children:Object(p.jsx)("a",{className:"nav-link",id:"artists",onClick:function(){y("artists")},children:"Artists"})})]}),Object(p.jsxs)("ul",{className:"nav nav-pills",children:[Object(p.jsx)("li",{style:{cursor:"pointer"},className:"nav-item",children:Object(p.jsx)("a",{className:"nav-link active",id:"this-month",onClick:function(){N("this-month")},children:"This Month"})}),Object(p.jsx)("li",{style:{cursor:"pointer"},className:"nav-item",children:Object(p.jsx)("a",{className:"nav-link",id:"last-6-months",onClick:function(){N("last-6-months")},children:"Last 6 Months"})}),Object(p.jsx)("li",{style:{cursor:"pointer"},className:"nav-item",children:Object(p.jsx)("a",{className:"nav-link",id:"all-time",onClick:function(){N("all-time")},children:"All Time"})})]})]}),Object(p.jsx)("ul",{className:"list-group list-group-flush overflow-auto",style:{height:"100%"},children:"tracks"==s?m.map((function(e,t){return Object(p.jsx)(k,{track:e,index:t},e.id)})):g.map((function(e,t){return Object(p.jsx)(w,{artist:e,index:t},e.id)}))})]})}var _,S=s(10),T=s(2),I=function(){localStorage.removeItem("spotify_access_token"),localStorage.removeItem("spotify_refresh_token"),localStorage.removeItem("spotify_expiration_time"),window.location.reload()},L=function(){var e=localStorage.getItem("spotify_refresh_token");u.post("/auth/refresh",{localRefreshToken:e}).then((function(e){h(e.data.accessToken)})).catch((function(e){I()}))},E=function e(){_&&clearTimeout(_);var t=f()-(new Date).getTime();console.log(t),_=setTimeout(Object(l.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L();case 2:e();case 3:case"end":return t.stop()}}),t)}))),t-1e4)},B=function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b()){e.next=2;break}throw new Error("Missing access token");case 2:if(!((new Date).getTime()>f())){e.next=6;break}return e.next=5,L();case 5:return e.abrupt("return");case 6:E();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function C(){return Object(p.jsxs)("div",{className:"container-fluid d-flex flex-column",children:[Object(p.jsx)("div",{className:"container-fluid my-3",children:Object(p.jsxs)("nav",{className:"row",children:[Object(p.jsx)("div",{className:"col d-flex align-items-center justify-content-start",style:{color:"white"},children:Object(p.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[Object(p.jsx)("img",{src:v,style:{height:"50px"}}),Object(p.jsx)("h1",{style:{color:"#1DB954"},children:"songbird"})]})}),Object(p.jsx)("div",{className:"col d-flex align-items-center justify-content-center",children:Object(p.jsx)(S.b,{to:"",style:{textDecoration:"none",color:"white"},children:"Dashboard"})}),Object(p.jsx)("div",{className:"col d-flex align-items-center justify-content-end",children:Object(p.jsx)("button",{className:"btn btn-outline-danger ms-3",style:{fontSize:"12px",padding:"8px 16px"},onClick:I,children:"Logout"})})]})}),Object(p.jsx)(T.b,{})]})}s(49);var D=function(){var e=Object(c.useState)(),t=Object(d.a)(e,2),s=t[0],n=t[1],a=Object(c.useState)(!0),i=Object(d.a)(a,2),r=i[0],j=i[1];return Object(c.useEffect)((function(){var e=function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,j(!0),e.next=4,B();case 4:n(!0),j(!1),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),n(!1),j(!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[]),r?Object(p.jsx)(g,{}):Object(p.jsx)(S.a,{children:Object(p.jsxs)(T.e,{children:[Object(p.jsx)(T.c,{path:"/",element:s?Object(p.jsx)(T.a,{to:"/dashboard"}):Object(p.jsx)(y,{})}),Object(p.jsx)(T.c,{path:"/dashboard",element:s?Object(p.jsx)(C,{}):Object(p.jsx)(T.a,{to:"/"}),children:Object(p.jsx)(T.c,{path:"",element:Object(p.jsx)(N,{})})}),Object(p.jsx)(T.c,{path:"*",element:s?Object(p.jsx)(T.a,{to:"/dashboard"}):Object(p.jsx)(T.a,{to:"/"})})]})})};i.a.render(Object(p.jsx)(n.a.StrictMode,{children:Object(p.jsx)(D,{})}),document.getElementById("root"))}},[[50,1,2]]]);
//# sourceMappingURL=main.bb7d609b.chunk.js.map